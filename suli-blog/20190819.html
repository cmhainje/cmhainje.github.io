<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8">
  <title>Aug 19 - Monday</title>
</head>
<body>

<a href="index.html">Index of blog posts</a>

<h1>Aug 19 - Monday</h1>

<p>
  Today I got the analytic likelihoods with TTS and background implemented. I have a simulation script that runs single-particle event simulations, and extracts all the data we need to compare BASF2 analytic, offline analytic, and Monte Carlo likelihoods.
</p>

<h2>Offline analytic likelihoods</h2>
<p>
  I calculate for roughly 1700 particles the analytic likelihoods and then compare them to the BASF2 likelihoods. These are the results. I'm showing a scatterplot of "online" (BASF2) likelihoods versus offline likelihoods. We hope for a rather straight line with increasing slope.
</p>

<img src="resources/20190819/online_vs_offline_Lpi.png" alt="">
<img src="resources/20190819/online_vs_offline_LK.png" alt="">
<img src="resources/20190819/online_vs_offline_Ldiff.png" alt="">

<p>
  This is pretty bad. There is no apparent correlation between the likelihoods, as most of these points fall into a bit of a blog. We wonder, then, if there is some issue where the channel PDFs we use to calculate the analytic likelihoods are getting offset from the channels written out.
  <br>
  The "channel" or pixel ID that gets written out for each digit is an integer from 1 to 512 (inclusive). Our data structures that store the channel PDFs, however, are indexed 0 to 511, so to access the likelihood at a channel <code>ch</code> and time <code>t</code>, we get the value of the <code>ch-1</code> channel PDF at <code>t</code>. As such, to see if there is just some problem with this <code>ch-1</code> mapping, I tried to just omit the map and use only <code>ch</code>. Here is the result.
</p>

<img src="resources/20190819/offby1_Lpi.png" alt="">
<img src="resources/20190819/offby1_LK.png" alt="">
<img src="resources/20190819/offby1_Ldiff.png" alt="">

<p>
  This is significantly better. It's what we had hoped to see the first time. We just don't understand why mapping the pixel IDs to what should <i>not</i> be their corresponding channel PDFs would improve performance. A more deep look into this coming next Tuesday.
</p>

</body>
</html>
