/* Raster grid subsystem (rsms.me/raster) */
r-grid {
  display: grid;
  --grid-tc: repeat(3, 1fr);
  grid-template-columns: var(--grid-tc);
  --grid-cs: 1; /* column start */
  --grid-ce: -1; /* column end */
}

/* r-cell -- cell or column */
r-grid > r-cell {
  display: block;
  appearance: none;
  -webkit-appearance: none;
}

r-grid[columns="1"] {
  --grid-tc: repeat(1, 1fr);
}
r-grid[columns="2"] {
  --grid-tc: repeat(2, 1fr);
}
r-grid[columns="3"] {
  --grid-tc: repeat(3, 1fr);
}

/* span=start... */
r-grid > r-cell[span^="1"] {
  --grid-cs: 1;
}
r-grid > r-cell[span^="2"] {
  --grid-cs: 2;
}
r-grid > r-cell[span^="3"] {
  --grid-cs: 3;
}

r-grid > r-cell[order="-1"] {
  order: -1;
}
r-grid > r-cell[order="-2"] {
  order: -2;
}
r-grid > r-cell[order="-3"] {
  order: -3;
}
r-grid > r-cell[order="-4"] {
  order: -4;
}
r-grid > r-cell[order="-4"] {
  order: -4;
}

/* span=...+width, span=...-end */
r-grid > r-cell[span$="+1"],
r-grid > r-cell[span="1"] {
  --grid-ce: 1;
}
r-grid > r-cell[span$="+2"],
r-grid > r-cell[span$="-1"],
r-grid > r-cell[span="2"] {
  --grid-ce: 2;
}
r-grid > r-cell[span$="+3"],
r-grid > r-cell[span$="-2"],
r-grid > r-cell[span="3"] {
  --grid-ce: 3;
}
r-grid > r-cell[span$="-3"] {
  --grid-ce: 4;
}

/* connect vars */
r-grid > r-cell[span] {
  grid-column-end: span var(--grid-ce);
}
r-grid > r-cell[span*="+"],
r-grid > r-cell[span*="-"],
r-grid > r-cell[span*=".."] {
  grid-column-start: var(--grid-cs);
}
r-grid > r-cell[span*="-"],
r-grid > r-cell[span*=".."] {
  grid-column-end: var(--grid-ce);
}
r-grid > r-cell[span="row"] {
  grid-column: 1 / -1;
}

/* for window width <= 850 */
@media only screen and (max-width: 850px) {
  r-grid[columns-s="1"] {
    --grid-tc: repeat(1, 1fr);
  }
  r-grid[columns-s="2"] {
    --grid-tc: repeat(2, 1fr);
  }
  r-grid[columns-s="3"] {
    --grid-tc: repeat(3, 1fr);
  }

  r-grid > r-cell[order-s="-1"] {
    order: -1;
  }
  r-grid > r-cell[order-s="-2"] {
    order: -2;
  }
  r-grid > r-cell[order-s="-3"] {
    order: -3;
  }
  r-grid > r-cell[order-s="-4"] {
    order: -4;
  }

  /* span-s=start... */
  r-grid > r-cell[span-s^="1"] {
    --grid-cs: 1;
  }
  r-grid > r-cell[span-s^="2"] {
    --grid-cs: 2;
  }
  r-grid > r-cell[span-s^="3"] {
    --grid-cs: 3;
  }

  /* span-s=...+width, span-s=...-end */
  r-grid > r-cell[span-s$="+1"],
  r-grid > r-cell[span-s="1"] {
    --grid-ce: 1;
  }
  r-grid > r-cell[span-s$="+2"],
  r-grid > r-cell[span-s$="-1"],
  r-grid > r-cell[span-s="2"] {
    --grid-ce: 2;
  }
  r-grid > r-cell[span-s$="+3"],
  r-grid > r-cell[span-s$="-2"],
  r-grid > r-cell[span-s="3"] {
    --grid-ce: 3;
  }
  r-grid > r-cell[span-s$="-3"] {
    --grid-ce: 4;
  }

  /* connect vars */
  r-grid > r-cell[span-s] {
    grid-column-end: span var(--grid-ce);
  }
  r-grid > r-cell[span-s*="+"],
  r-grid > r-cell[span-s*="-"],
  r-grid > r-cell[span-s*=".."] {
    grid-column-start: var(--grid-cs);
  }
  r-grid > r-cell[span-s*="-"],
  r-grid > r-cell[span-s*=".."] {
    grid-column-end: var(--grid-ce);
  }
  r-grid > r-cell[span-s="row"] {
    grid-column: 1 / -1;
  }
}

/* for window width >= 1600 */
@media only screen and (min-width: 1599px) {
  r-grid[columns-l="1"] {
    --grid-tc: repeat(1, 1fr);
  }
  r-grid[columns-l="2"] {
    --grid-tc: repeat(2, 1fr);
  }
  r-grid[columns-l="3"] {
    --grid-tc: repeat(3, 1fr);
  }

  /* span-l=start... */
  r-grid > r-cell[span-l^="1"] {
    --grid-cs: 1;
  }
  r-grid > r-cell[span-l^="2"] {
    --grid-cs: 2;
  }
  r-grid > r-cell[span-l^="3"] {
    --grid-cs: 3;
  }

  /* span-l=...+width, span-l=...-end */
  r-grid > r-cell[span-l$="+1"],
  r-grid > r-cell[span-l="1"] {
    --grid-ce: 1;
  }
  r-grid > r-cell[span-l$="+2"],
  r-grid > r-cell[span-l$="-1"],
  r-grid > r-cell[span-l="2"] {
    --grid-ce: 2;
  }
  r-grid > r-cell[span-l$="+3"],
  r-grid > r-cell[span-l$="-2"],
  r-grid > r-cell[span-l="3"] {
    --grid-ce: 3;
  }
  r-grid > r-cell[span-l$="-3"] {
    --grid-ce: 4;
  }

  /* connect vars */
  r-grid > r-cell[span-l] {
    grid-column-end: span var(--grid-ce);
  }
  r-grid > r-cell[span-l*="+"],
  r-grid > r-cell[span-l*="-"],
  r-grid > r-cell[span-l*=".."] {
    grid-column-start: var(--grid-cs);
  }
  r-grid > r-cell[span-l*="-"],
  r-grid > r-cell[span-l*=".."] {
    grid-column-end: var(--grid-ce);
  }
  r-grid > r-cell[span-l="row"] {
    grid-column: 1 / -1;
  }
}

/* .debug can be added to a r-grid to visualize its effective cells */
r-grid.debug > * {
  --color: rgba(248, 110, 91, 0.3);
  background-image: linear-gradient(
    to bottom,
    var(--color) 0%,
    var(--color) 100%
  );
}
r-grid.debug > :nth-child(3n + 2) {
  --color: rgba(103, 126, 208, 0.3);
}
r-grid.debug > :nth-child(3n + 3) {
  --color: rgba(224, 174, 72, 0.3);
}
r-grid.debug > :nth-child(3n + 4) {
  --color: rgba(77, 214, 115, 0.3);
}
